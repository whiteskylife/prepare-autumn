# 网络分层

osi七层：

应用层、表示层、会话层、传输层、网络层、链路、物理层

TCP/IP四层：

应用层、传输层、网络层、物理链路层

五层结构：

应用层、传输层、网络层、链路、物理层

# 应用层

|       应用       | 应用层协议 | 端口号  | 传输层协议 |            备注             |
| :--------------: | :--------: | :-----: | :--------: | :-------------------------: |
|     域名解析     |    DNS     |   53    |  UDP/TCP   | 长度超过 512 字节时使用 TCP |
| 动态主机配置协议 |    DHCP    |  67/68  |    UDP     |                             |
| 简单网络管理协议 |    SNMP    | 161/162 |    UDP     |                             |
|   文件传送协议   |    FTP     |  20/21  |    TCP     |  控制连接 21，数据连接 20   |
|   远程终端协议   |   TELNET   |   23    |    TCP     |                             |
|  超文本传送协议  |    HTTP    |   80    |    TCP     |                             |
| 简单邮件传送协议 |    SMTP    |   25    |    TCP     |                             |
|   邮件读取协议   |    POP3    |   110   |    TCP     |                             |
| 网际报文存取协议 |    IMAP    |   143   |    TCP     |                             |

# DNS

域名系统DNS(Domain Name System)是因特网使用的命名系统，用来把便于人们使用的机器名字转换成为IP地址。域名系统其实就是名字系统。

DNS的左右就是将 `www.xxx.cn`这样的字符串解析成IP地址。

例如cctv的邮件域名：

![img](/Users/thisxzj/GitHub/prepare-autumn/photo/cctv域名.png)

从语法上讲，每一个域名都是有标号(label)序列组成，而各标号之间用点(小数点)隔开。

域名服务器：

![img](/Users/thisxzj/GitHub/prepare-autumn/photo/SouthEastaa.png)

递归查询和迭代查询：

![img](/Users/thisxzj/GitHub/prepare-autumn/photo/SouthEast.png)

迭代查询的特点：当服务器收到客户端发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个服务器进行查询”。

递归查询就是：如果客户端所询问的服务器不知道被查询的域名的IP地址，那么服务器就以客户端的身份，向其它服务器继续发出查询请求报文(即替客户端继续查询)，而不是让客户端自己进行下一步查询。

通常主机向本地域名服务器发出的请求是递归查询，本地域名服务器在不知道请求的域名的情况下，向上级发出的请求是迭代查询，也就是图b。

以输入了`www.baidu.com`为例子

1. 输入`www.baidu.com`。
2. 浏览器向本地DNS服务器发送查询`www.baidu.com`的请求。
3. 本地DNS向根服务器查询`.com`的地址。
4. 本地DNS向`.com`服务器查询`baidu.com`的地址。
5. 本地DNS向`baidu.com`服务器查询`www.baidu.com`的地址。
6. 本地DNS将`www.baidu.com`的IP地址返回给浏览器。
7. 得到目标域名的IP地址之后，和服务器建立一个http连接。

通常为了提高DNS查询效率，并减轻服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器中广泛使用了高速缓存，用来存放最近查询过的域名以及从何处获得域名映射信息的记录。

例如，在上面的查询过程中，如果在`www.baidu.com`的主机上不久前已经有用户查询过`www.baidu.com`的IP地址，那么本地域名服务器就不必向根域名服务器重新查询`www.baidu.com`的IP地址，而是直接把告诉缓存中存放的上次查询结果(即`www.baidu.com`的IP地址)告诉用户。

由于名字到地址的绑定并不经常改变，为保持告诉缓存中的内容正确，域名服务器应为每项内容设置计时器并处理超过合理时间的项(例如每个项目两天)。当域名服务器已从缓存中删去某项信息后又被请求查询该项信息，就必须重新到授权管理该项的域名服务器绑定信息。当权限服务器回答一个查询请求时，在响应中都指明绑定有效存在的时间值。增加此时间值可减少网络开销，而减少此时间值可提高域名解析的正确性。